<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch 2025 CR Election</title>
    <!-- Load Tailwind CSS CDN for modern, responsive styling --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font setup */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        :root {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styling for the results panel */
        #results-panel {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .results-open {
            max-height: 500px !important; /* Arbitrary large value */
            padding-top: 1.5rem;
            padding-bottom: 1.5rem;
        }

        /* Watermark Styles */
        .watermark-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://raw.githubusercontent.com/kanishk2007dev/gmcbundi/3ba9bed8a9bd360ca811aec70d78953c00e24bdd/ChatGPT%20Image%20Nov%2013%2C%202025%2C%2010_38_51%20PM%20(1).svg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%; /* Controls the size of the watermark */
            opacity: 0.05; /* Makes it very faint */
            z-index: 0; /* Ensures it stays behind the main content */
            pointer-events: none; /* Allows clicks to pass through */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <!-- Watermark Background Layer --><div class="watermark-background"></div>

    <!-- Main Application Container --><div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden relative z-10">
        
        <!-- Header --><header class="p-6 sm:p-8 bg-indigo-600 text-white relative">
            <!-- College Logo --><img src="https://raw.githubusercontent.com/kanishk2007dev/gmc-bundi/refs/heads/main/ChatGPT%20Image%20Nov%2013%2C%202025%2C%2010_38_51%20PM.png" 
                 alt="GMC Bundi Logo" 
                 class="absolute top-4 left-4 h-16 sm:h-20 w-auto rounded-full shadow-lg border-2 border-white"
                 onerror="this.onerror=null; this.src='https://placehold.co/80x80/ffffff/000000?text=GMC'">

            <div class="ml-24 sm:ml-28"> 
                <h2 class="text-xl sm:text-2xl font-semibold text-indigo-200 mb-1">
                    GOVERNMENT MEDICAL COLLEGE BUNDI
                </h2>
                <h1 class="text-3xl sm:text-4xl font-extrabold flex items-center">
                    <!-- Election Commission Logo --><img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Election_Commission_of_India_Logo.svg" 
                         alt="Election Commission of India Logo" 
                         class="w-10 h-10 mr-3 bg-white p-1 rounded-full shadow-lg"
                         onerror="this.onerror=null; this.src='https://placehold.co/40x40/ffffff/000000?text=ECI'">
                    Batch 2025 CR Election
                </h1>
                <p class="mt-2 text-indigo-200 text-lg">Select your Class Representative. Your vote is confidential.</p>
            </div>
        </header>

        <!-- Voting Area --><main class="p-6 sm:p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Candidates for CR</h2>
            
            <!-- Candidate Grid: Adjusted to handle 4 columns on large screens --><div id="candidate-list" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
                <!-- Candidate Cards will be generated here by JavaScript --></div>

            <!-- Action Area / Results Toggle --><div class="mt-8 pt-6 border-t border-gray-200 flex flex-col sm:flex-row justify-between items-center">
                <p id="voting-status" class="text-lg font-semibold text-gray-600 mb-4 sm:mb-0">
                    <span id="vote-message">Please cast your vote.</span>
                </p>
                <button id="toggle-results-btn" onclick="toggleResults()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-md transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Show Results
                </button>
            </div>
            
            <!-- Results Panel --><div id="results-panel" class="mt-4 bg-blue-50 rounded-xl p-0 transition-all duration-300">
                <h3 class="text-xl font-bold text-blue-800 mb-4">Election Results (Simulated)</h3>
                <div id="results-content" class="space-y-4">
                    <!-- Results will be displayed here --></div>
            </div>

            <!-- Info Message Box (Modal Substitute) --><div id="info-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 text-center">
                    <svg id="modal-icon" class="w-12 h-12 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h4 id="modal-title" class="text-xl font-bold mt-4 text-gray-800">Vote Recorded!</h4>
                    <p id="modal-body" class="mt-2 text-gray-600"></p>
                    <button onclick="closeModal()" class="mt-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150">
                        Got it
                    </button>
                </div>
            </div>

        </main>
        
        <!-- Footer / Disclaimer --><footer class="p-4 bg-gray-100 text-center text-sm text-gray-500 border-t rounded-b-2xl">
            <p class="mb-1">Created by KANISHK MBBS STUNDENT AT GMC BUNDI</p>
            <p>CR Election for Batch 2025 at GMC Bundi | Disclaimer: This is a front-end simulation using **Local Storage**. Results are unique to your browser.</p>
        </footer>

    </div>

    <!-- Standard JavaScript Logic (Using Local Storage) --><script>
        // Constants
        const CANDIDATES = [
            { id: 1, name: "MAYANK MEENA", manifesto: "Focussing on personalized academic support and mentorship programs.", color: "red-500", photo: "https://raw.githubusercontent.com/kanishk2007dev/gmc-bundi/refs/heads/main/Screenshot%202025-11-19%20203457.png" },
            { id: 2, name: "ANVESH", manifesto: "Organizing engaging extracurricular activities and boosting batch spirit.", color: "green-500", photo: "https://raw.githubusercontent.com/kanishk2007dev/gmc-bundi/refs/heads/main/Screenshot%202025-11-19%20203451.png" },
            { id: 3, name: "Shyam Sundar Kavia", manifesto: "Improving classroom infrastructure and establishing a seamless feedback channel.", color: "blue-500", photo: "https://raw.githubusercontent.com/kanishk2007dev/gmc-bundi/refs/heads/main/Screenshot%202025-11-19%20203506.png" },
            { id: 4, name: "Existing CR", manifesto: "Continuity of current initiatives and maximizing resource utilization.", color: "purple-500", photo: "https://placehold.co/100x100/ede9fe/6d28d9?text=ECR" }
        ];

        // Global state check using Local Storage keys
        let userHasVoted = localStorage.getItem('hasVotedCR2025') === 'true';
        let votedFor = localStorage.getItem('votedForCR2025');

        /**
         * Initializes the voting application on load.
         */
        document.addEventListener('DOMContentLoaded', () => {
            renderCandidates();
            updateVotingStatus();
            loadResults(); // Load initial results (which are simulated local data)
        });

        /**
         * Renders candidate cards into the DOM.
         */
        function renderCandidates() {
            const listContainer = document.getElementById('candidate-list');
            listContainer.innerHTML = '';
            
            CANDIDATES.forEach(candidate => {
                const card = document.createElement('div');
                card.className = `bg-white border border-${candidate.color} p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 flex flex-col justify-between h-full`;
                card.innerHTML = `
                    <div>
                        <img src="${candidate.photo}" alt="Photo of ${candidate.name}" class="w-20 h-20 rounded-full mx-auto mb-4 object-cover border-4 border-${candidate.color}" 
                            onerror="this.onerror=null; this.src='https://placehold.co/100x100/CCCCCC/000000?text=${candidate.name.charAt(0)}';">
                        <h3 class="text-xl font-bold text-gray-900 text-center">${candidate.name}</h3>
                        <p class="text-sm text-gray-500 text-center mb-4">Candidate #${candidate.id}</p>
                        <p class="text-gray-700 mt-2 text-center text-sm">${candidate.manifesto}</p>
                    </div>
                    <button id="vote-btn-${candidate.id}" onclick="castVote(${candidate.id}, '${candidate.name}')" 
                        class="mt-6 w-full bg-${candidate.color} text-white font-semibold py-3 rounded-xl shadow-md transition duration-200 hover:bg-opacity-90 disabled:bg-gray-400 disabled:cursor-not-allowed">
                        Vote for ${candidate.name.split(' ')[0]}
                    </button>
                `;
                listContainer.appendChild(card);
            });
            updateVoteButtons();
        }

        /**
         * Updates the state and message displayed to the user.
         */
        function updateVotingStatus() {
            const statusElement = document.getElementById('vote-message');

            if (userHasVoted) {
                statusElement.innerHTML = `<span class="text-green-600">You have successfully voted for <strong>${votedFor}</strong>.</span>`;
            } else {
                statusElement.textContent = "Please cast your vote to proceed.";
            }
            updateVoteButtons();
        }

        /**
         * Disables all vote buttons if the user has already voted.
         */
        function updateVoteButtons() {
            CANDIDATES.forEach(candidate => {
                const button = document.getElementById(`vote-btn-${candidate.id}`);
                if (button) {
                    if (userHasVoted) {
                        button.disabled = true;
                        const firstName = candidate.name.split(' ')[0];
                        button.textContent = votedFor === candidate.name ? `VOTED (${firstName})` : 'Voted';
                        button.classList.add('bg-gray-400', 'cursor-not-allowed');
                        button.classList.remove('hover:bg-opacity-90'); // Clean up hover effect
                    } else {
                        button.disabled = false;
                        button.textContent = `Vote for ${candidate.name.split(' ')[0]}`;
                        button.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        button.classList.add('hover:bg-opacity-90'); 
                    }
                }
            });
        }

        /**
         * Simulates casting a vote using Local Storage.
         * @param {number} candidateId - The ID of the candidate.
         * @param {string} candidateName - The name of the candidate.
         */
        window.castVote = function(candidateId, candidateName) {
            if (userHasVoted) {
                showModal('Alert', `You have already cast your vote for <strong>${votedFor}</strong>.`, 'orange');
                return;
            }

            // 1. Simulate saving the vote
            const votesKey = 'cr2025Votes';
            let voteCounts = JSON.parse(localStorage.getItem(votesKey) || '{}');
            
            // Initialize count if candidate is new
            if (!voteCounts[candidateName]) {
                voteCounts[candidateName] = 0;
            }
            
            // Increment the count (this is shared data)
            voteCounts[candidateName] += 1;
            localStorage.setItem(votesKey, JSON.stringify(voteCounts));

            // 2. Mark the user as having voted (this is private data for the user)
            localStorage.setItem('hasVotedCR2025', 'true');
            localStorage.setItem('votedForCR2025', candidateName);
            userHasVoted = true;
            votedFor = candidateName;

            // 3. Update UI
            updateVotingStatus();
            loadResults(); // Refresh results to show new vote
            
            // 4. Show success message
            showModal('Vote Recorded!', `Thank you! Your vote for <strong>${candidateName}</strong> has been cast.`, 'green');
        }

        /**
         * Toggles the visibility of the results panel.
         */
        window.toggleResults = function() {
            const resultsPanel = document.getElementById('results-panel');
            const button = document.getElementById('toggle-results-btn');

            if (resultsPanel.classList.contains('results-open')) {
                resultsPanel.classList.remove('results-open');
                button.textContent = 'Show Results';
                button.classList.remove('bg-red-500');
                button.classList.add('bg-blue-500');
            } else {
                loadResults(); // Load the latest results before opening
                resultsPanel.classList.add('results-open');
                button.textContent = 'Hide Results';
                button.classList.remove('bg-blue-500');
                button.classList.add('bg-red-500');
            }
        }

        /**
         * Loads and displays the simulated vote results from Local Storage.
         */
        function loadResults() {
            const votesKey = 'cr2025Votes';
            const voteCounts = JSON.parse(localStorage.getItem(votesKey) || '{}');
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = '';

            let totalVotes = Object.values(voteCounts).reduce((sum, count) => sum + count, 0);

            if (totalVotes === 0) {
                resultsContent.innerHTML = '<p class="text-gray-500 italic">No votes have been cast yet. Be the first to vote!</p>';
                return;
            }

            // Create a sorted array of results
            const resultsArray = CANDIDATES.map(c => ({
                name: c.name,
                votes: voteCounts[c.name] || 0,
                color: c.color
            })).sort((a, b) => b.votes - a.votes);

            resultsArray.forEach(result => {
                const percentage = totalVotes > 0 ? ((result.votes / totalVotes) * 100).toFixed(1) : 0;
                
                const resultBar = document.createElement('div');
                resultBar.className = 'flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-4';
                resultBar.innerHTML = `
                    <p class="font-medium text-lg w-full sm:w-1/3 text-gray-800">${result.name}</p>
                    <div class="relative w-full sm:w-2/3 h-8 bg-gray-200 rounded-full overflow-hidden shadow-inner">
                        <div style="width: ${percentage}%;" 
                            class="absolute top-0 left-0 h-full bg-${result.color} transition-all duration-500 ease-out">
                        </div>
                        <span class="absolute right-0 top-0 h-full flex items-center pr-3 font-bold text-white text-sm" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                            ${result.votes} Votes (${percentage}%)
                        </span>
                    </div>
                `;
                resultsContent.appendChild(resultBar);
            });
        }
        
        /**
         * Shows a custom modal message box.
         */
        window.showModal = function(title, body, iconColor) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = body;
            
            const icon = document.getElementById('modal-icon');
            // Use setAttribute('class', ...) for SVG elements to avoid the TypeError
            icon.setAttribute('class', `w-12 h-12 mx-auto text-${iconColor}-500`); 

            // Simple switch to pick the right icon based on color/context
            if (iconColor === 'green') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            } else if (iconColor === 'orange') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
            }

            document.getElementById('info-modal').classList.remove('hidden');
        }

        /**
         * Hides the custom modal message box.
         */
        window.closeModal = function() {
            document.getElementById('info-modal').classList.add('hidden');
        }

    </script>
</body>
</html>
